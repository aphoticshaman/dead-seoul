<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>DEAD SEOUL</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;700&family=Cinzel:wght@400;700&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --blood: #8b0000;
            --blood-glow: rgba(139, 0, 0, 0.6);
            --bone: #e8e0d5;
            --void: #0a0808;
            --ash: #1a1818;
            --smoke: #2a2626;
            --ghost: rgba(255, 255, 255, 0.03);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            background: var(--void);
            font-family: 'Noto Serif KR', serif;
            color: var(--bone);
            line-height: 1.8;
        }

        /* Black Mirror scan lines */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.03) 2px,
                rgba(0, 0, 0, 0.03) 4px
            );
        }

        /* Vignette effect */
        .vignette {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            background: radial-gradient(
                ellipse at center,
                transparent 40%,
                rgba(0, 0, 0, 0.8) 100%
            );
        }

        /* Blood drip animation */
        .blood-drip {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            background:
                radial-gradient(ellipse at 15% 0%, var(--blood-glow) 0%, transparent 40%),
                radial-gradient(ellipse at 85% 0%, rgba(100, 0, 0, 0.3) 0%, transparent 35%);
            animation: bloodPulse 8s ease-in-out infinite;
        }

        @keyframes bloodPulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.7; }
        }

        /* Main container */
        .game-container {
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
            z-index: 100;
            background: var(--void);
        }

        /* Header */
        .header {
            padding: 1rem;
            border-bottom: 1px solid var(--smoke);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, rgba(10, 8, 8, 0.95) 0%, transparent 100%);
        }

        .title-small {
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            letter-spacing: 0.3em;
            color: var(--blood);
        }

        .progress-indicator {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: rgba(139, 0, 0, 0.6);
        }

        /* Content area */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 2rem 1.5rem 4rem;
            -webkit-overflow-scrolling: touch;
        }

        /* Section styling */
        .section {
            display: none;
            animation: fadeIn 0.8s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Media containers */
        .media-container {
            margin: 2rem -1.5rem;
            position: relative;
        }

        .media-container img,
        .media-container video {
            width: 100%;
            display: block;
        }

        .media-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                180deg,
                var(--void) 0%,
                transparent 15%,
                transparent 85%,
                var(--void) 100%
            );
            pointer-events: none;
        }

        /* Typography */
        .section-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: rgba(139, 0, 0, 0.4);
            letter-spacing: 0.2em;
            margin-bottom: 0.5rem;
        }

        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 1.4rem;
            color: var(--blood);
            letter-spacing: 0.1em;
            margin-bottom: 2rem;
            text-transform: uppercase;
        }

        .narrative {
            font-size: 1rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
            text-align: justify;
        }

        .narrative em {
            font-style: italic;
            color: rgba(232, 224, 213, 0.8);
        }

        .narrative strong {
            font-weight: 700;
            color: var(--bone);
        }

        .dialogue {
            font-style: italic;
            padding-left: 1.5rem;
            border-left: 2px solid var(--blood);
            margin: 1.5rem 0;
            color: rgba(232, 224, 213, 0.9);
        }

        .thought {
            color: rgba(139, 0, 0, 0.7);
            font-style: italic;
        }

        /* Poetic interludes - Ryan's voice */
        .poetic {
            font-size: 0.95rem;
            line-height: 2;
            text-align: center;
            padding: 2rem 1rem;
            margin: 2rem 0;
            border-top: 1px solid rgba(139, 0, 0, 0.2);
            border-bottom: 1px solid rgba(139, 0, 0, 0.2);
            color: rgba(232, 224, 213, 0.7);
            font-style: italic;
        }

        /* Spicy content styling */
        .spicy {
            background: linear-gradient(90deg, transparent, rgba(139, 0, 0, 0.05), transparent);
            padding: 1.5rem;
            margin: 1.5rem -0.5rem;
            border-radius: 4px;
        }

        /* Choices */
        .choices {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--smoke);
        }

        .choices-header {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: rgba(139, 0, 0, 0.5);
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 1.5rem;
        }

        .choice {
            display: block;
            width: 100%;
            padding: 1.2rem 1.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(90deg, rgba(139, 0, 0, 0.1), transparent);
            border: 1px solid rgba(139, 0, 0, 0.3);
            border-radius: 4px;
            color: var(--bone);
            font-family: 'Noto Serif KR', serif;
            font-size: 0.95rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice::before {
            content: '‚û§';
            position: absolute;
            left: -30px;
            opacity: 0;
            color: var(--blood);
            transition: all 0.3s ease;
        }

        .choice:hover, .choice:active {
            background: linear-gradient(90deg, rgba(139, 0, 0, 0.2), rgba(139, 0, 0, 0.05));
            border-color: var(--blood);
            padding-left: 2.5rem;
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.2);
        }

        .choice:hover::before, .choice:active::before {
            left: 1rem;
            opacity: 1;
        }

        /* Ending styling */
        .ending {
            text-align: center;
            padding: 3rem 1rem;
        }

        .ending-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: rgba(139, 0, 0, 0.5);
            letter-spacing: 0.3em;
            margin-bottom: 1rem;
        }

        .ending-title {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            color: var(--blood);
            letter-spacing: 0.2em;
            margin-bottom: 2rem;
            text-shadow: 0 0 40px var(--blood-glow);
        }

        .ending-text {
            font-size: 1rem;
            line-height: 2;
            color: rgba(232, 224, 213, 0.8);
        }

        .restart-btn {
            margin-top: 3rem;
            padding: 1rem 2rem;
            background: transparent;
            border: 1px solid var(--blood);
            color: var(--blood);
            font-family: 'Cinzel', serif;
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: var(--blood);
            color: var(--void);
        }

        /* Thread visualization */
        .thread-indicator {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--smoke);
            z-index: 100;
            display: flex;
        }

        .thread {
            flex: 1;
            height: 100%;
            transition: background 0.5s ease;
        }

        .thread.active {
            background: var(--blood);
        }

        .thread.visited {
            background: rgba(139, 0, 0, 0.4);
        }

        /* Connection reveal animation */
        .connection-reveal {
            animation: connectionPulse 2s ease-out;
        }

        @keyframes connectionPulse {
            0% {
                background: rgba(139, 0, 0, 0.3);
                box-shadow: 0 0 50px var(--blood-glow);
            }
            100% {
                background: transparent;
                box-shadow: none;
            }
        }

        /* Safari-specific */
        @supports (-webkit-touch-callout: none) {
            body {
                min-height: -webkit-fill-available;
            }
            .game-container {
                height: -webkit-fill-available;
            }
        }

        /* Loading state */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--void);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 0.5s ease;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-family: 'Space Mono', monospace;
            font-size: 0.8rem;
            color: var(--blood);
            letter-spacing: 0.3em;
            animation: loadingPulse 1.5s ease-in-out infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           50 UX/UI ENHANCEMENTS
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* 1. TYPEWRITER EFFECT */
        .typewriter {
            overflow: hidden;
            border-right: 2px solid var(--blood);
            white-space: nowrap;
            animation: typing 3s steps(40), blink 0.75s step-end infinite;
        }
        @keyframes typing { from { width: 0 } to { width: 100% } }
        @keyframes blink { 50% { border-color: transparent } }

        /* 2. PULSE FOR IMPORTANT ELEMENTS */
        .pulse {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 5px var(--blood-glow); }
            50% { box-shadow: 0 0 30px var(--blood-glow), 0 0 60px var(--blood-glow); }
        }

        /* 3. SHAKE FOR DANGER */
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* 4. GLITCH EFFECT */
        .glitch {
            animation: glitch 2s infinite;
        }
        @keyframes glitch {
            0%, 90%, 100% { transform: translate(0); filter: none; }
            92% { transform: translate(-2px, 2px); filter: hue-rotate(90deg); }
            94% { transform: translate(2px, -2px); filter: hue-rotate(-90deg); }
            96% { transform: translate(-1px, -1px); }
            98% { transform: translate(1px, 1px); filter: blur(1px); }
        }

        /* 5. FILM GRAIN OVERLAY - static, no animation */
        .film-grain {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 10;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* 6. HEARTBEAT ANIMATION */
        .heartbeat {
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            14% { transform: scale(1.1); }
            28% { transform: scale(1); }
            42% { transform: scale(1.1); }
            70% { transform: scale(1); }
        }

        /* 7. SCREEN FLASH ON CHOICE */
        .flash-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--blood);
            opacity: 0;
            pointer-events: none;
            z-index: 500;
            animation: flash 0.3s ease-out;
        }
        @keyframes flash {
            0% { opacity: 0.5; }
            100% { opacity: 0; }
        }

        /* 8. SMOOTH SCROLL */
        html { scroll-behavior: smooth; }
        .content { scroll-behavior: smooth; }

        /* 9. READING PROGRESS BAR */
        .reading-progress {
            position: fixed;
            top: 0; left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, var(--blood), #ff4444);
            z-index: 150;
            transition: width 0.2s ease-out;
        }

        /* 10. TOOLTIP SYSTEM */
        [data-tooltip] {
            position: relative;
            cursor: help;
        }
        [data-tooltip]:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ash);
            color: var(--bone);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
            border: 1px solid var(--blood);
            z-index: 1000;
            animation: tooltipFade 0.2s ease-out;
        }
        @keyframes tooltipFade {
            from { opacity: 0; transform: translateX(-50%) translateY(5px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* 11. CHOICE CONSEQUENCE HINTS */
        .choice[data-consequence]::after {
            content: attr(data-consequence);
            display: block;
            font-size: 0.7em;
            color: rgba(139, 0, 0, 0.5);
            margin-top: 4px;
            font-style: italic;
        }

        /* 12. RIPPLE EFFECT ON BUTTONS */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        .ripple::after {
            content: '';
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        @keyframes ripple {
            to { transform: scale(4); opacity: 0; }
        }

        /* 13. PARALLAX SCROLLING */
        .parallax-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 120%;
            background: radial-gradient(ellipse at 30% 20%, rgba(139,0,0,0.1), transparent 50%),
                        radial-gradient(ellipse at 70% 80%, rgba(100,0,0,0.1), transparent 50%);
            transform: translateY(var(--scroll-y, 0));
            z-index: 5;
            pointer-events: none;
        }

        /* 14. CARD REVEAL ANIMATION */
        .card-reveal {
            opacity: 0;
            transform: translateY(30px) rotateX(-10deg);
            animation: cardReveal 0.6s ease-out forwards;
        }
        @keyframes cardReveal {
            to { opacity: 1; transform: translateY(0) rotateX(0); }
        }

        /* 15. SKELETON LOADING */
        .skeleton {
            background: linear-gradient(90deg, var(--ash) 25%, var(--smoke) 50%, var(--ash) 75%);
            background-size: 200% 100%;
            animation: skeleton 1.5s ease-in-out infinite;
            border-radius: 4px;
        }
        @keyframes skeleton {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* 16. TOAST NOTIFICATIONS */
        .toast-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            background: linear-gradient(135deg, var(--ash), var(--smoke));
            border: 1px solid var(--blood);
            border-radius: 8px;
            padding: 15px 20px;
            color: var(--bone);
            font-size: 0.9em;
            animation: toastIn 0.3s ease-out, toastOut 0.3s ease-in 2.7s forwards;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }
        @keyframes toastIn {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes toastOut {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(100px); }
        }

        /* 17. ACHIEVEMENT POPUP */
        .achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(180deg, rgba(30,10,10,0.98), rgba(10,0,0,0.98));
            border: 2px solid var(--blood);
            border-radius: 15px;
            padding: 30px 50px;
            text-align: center;
            z-index: 10001;
            animation: achievementPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }
        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        .achievement-icon { font-size: 3em; margin-bottom: 10px; }
        .achievement-title { color: var(--blood); font-family: 'Cinzel', serif; font-size: 1.2em; }
        .achievement-desc { color: rgba(255,255,255,0.7); font-size: 0.9em; margin-top: 10px; }

        /* 18. CHARACTER PORTRAIT ANIMATIONS */
        .portrait {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px solid var(--blood);
            overflow: hidden;
            animation: portraitFloat 3s ease-in-out infinite;
        }
        @keyframes portraitFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* 19. BLOOD SPLATTER EFFECT */
        .blood-splatter {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: radial-gradient(circle at var(--x, 50%) var(--y, 50%),
                        var(--blood) 0%, transparent 30%);
            opacity: 0;
            pointer-events: none;
            z-index: 400;
            animation: splatter 0.5s ease-out forwards;
        }
        @keyframes splatter {
            0% { opacity: 0.8; transform: scale(0.5); }
            100% { opacity: 0; transform: scale(2); }
        }

        /* 20. VIGNETTE PULSE ON DANGER */
        .vignette-pulse {
            animation: vignettePulse 2s ease-in-out;
        }
        @keyframes vignettePulse {
            0%, 100% { background: radial-gradient(ellipse, transparent 40%, rgba(0,0,0,0.8) 100%); }
            50% { background: radial-gradient(ellipse, transparent 20%, rgba(139,0,0,0.5) 100%); }
        }

        /* 21. TEXT GLOW FOR IMPORTANT WORDS */
        .glow-text {
            text-shadow: 0 0 10px var(--blood), 0 0 20px var(--blood), 0 0 40px var(--blood);
            animation: textGlow 2s ease-in-out infinite alternate;
        }
        @keyframes textGlow {
            from { text-shadow: 0 0 5px var(--blood); }
            to { text-shadow: 0 0 20px var(--blood), 0 0 40px var(--blood); }
        }

        /* 22. FLOATING PARTICLES - DISABLED (performance) */
        .particles { display: none; }
        .particle { display: none; }

        /* 23. CURSOR EFFECTS - disabled for compatibility */
        /* Custom cursors disabled - use default */

        /* 24. TIMER COUNTDOWN STYLING */
        .countdown {
            font-family: 'Space Mono', monospace;
            font-size: 2em;
            color: var(--blood);
            text-align: center;
            animation: countdownPulse 1s ease-in-out infinite;
        }
        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        /* 25. WARNING INDICATOR */
        .warning {
            border-left: 4px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 10px 15px;
            margin: 10px 0;
            animation: warningPulse 2s ease-in-out infinite;
        }
        @keyframes warningPulse {
            0%, 100% { border-left-color: #ff6b6b; }
            50% { border-left-color: #ff0000; }
        }

        /* 26. SAFE ZONE INDICATOR */
        .safe-zone {
            border-left: 4px solid #50c878;
            background: rgba(80, 200, 120, 0.1);
            padding: 10px 15px;
        }

        /* 27. RELATIONSHIP HEARTS */
        .hearts {
            display: flex;
            gap: 3px;
        }
        .heart {
            color: #333;
            transition: all 0.3s ease;
        }
        .heart.filled {
            color: #ff4444;
            animation: heartPop 0.3s ease-out;
        }
        @keyframes heartPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* 28. JIN TRUST METER */
        .jin-meter {
            width: 100%;
            height: 8px;
            background: var(--smoke);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .jin-meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--blood), #ff4444, #ff8888);
            border-radius: 4px;
            transition: width 0.5s ease-out;
            position: relative;
        }
        .jin-meter-fill::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: meterShine 2s linear infinite;
        }
        @keyframes meterShine {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        /* 29. SNOW GLOBE SHIMMER */
        .globe {
            position: relative;
            display: inline-block;
        }
        .globe::before {
            content: '';
            position: absolute;
            top: -5px; left: -5px;
            right: -5px; bottom: -5px;
            border-radius: 50%;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            animation: shimmer 3s linear infinite;
        }
        @keyframes shimmer {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 30. ENDING SEED DISPLAY */
        .seed-display {
            font-family: 'Space Mono', monospace;
            background: var(--ash);
            border: 1px solid var(--blood);
            padding: 15px 20px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .seed-display:hover {
            background: var(--smoke);
            box-shadow: 0 0 20px var(--blood-glow);
        }
        .seed-display::before {
            content: 'üå± ';
        }

        /* 31. CHOICE HOVER STATES */
        .choice {
            transform-origin: left center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .choice:hover {
            transform: translateX(10px) scale(1.02);
        }
        .choice:active {
            transform: translateX(5px) scale(0.98);
        }

        /* 32. ACTIVE CHOICE INDICATOR */
        .choice.selected {
            border-color: #fff;
            background: linear-gradient(90deg, rgba(139,0,0,0.3), rgba(139,0,0,0.1));
        }
        .choice.selected::before {
            content: '‚úì';
            color: #50c878;
        }

        /* 33. THREAD PULSE ANIMATIONS */
        .thread.active {
            animation: threadPulse 2s ease-in-out infinite;
        }
        @keyframes threadPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 34. HEADER STICKY EFFECTS */
        .header {
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .header.scrolled {
            background: rgba(10, 8, 8, 0.98);
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }

        /* 35. CONTENT FADE TRANSITIONS */
        .section {
            animation: sectionEnter 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes sectionEnter {
            from { opacity: 0; transform: translateY(30px); filter: blur(5px); }
            to { opacity: 1; transform: translateY(0); filter: blur(0); }
        }

        /* 36. MEDIA ZOOM EFFECTS */
        .media-container img {
            transition: transform 0.5s ease;
        }
        .media-container:hover img {
            transform: scale(1.02);
        }

        /* 37. DIALOGUE BUBBLE STYLES */
        .dialogue {
            position: relative;
            background: rgba(139, 0, 0, 0.05);
            border-radius: 0 10px 10px 10px;
            padding: 1rem 1.5rem;
            margin: 1.5rem 0 1.5rem 1rem;
            animation: dialogueSlide 0.4s ease-out;
        }
        @keyframes dialogueSlide {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* 38. THOUGHT BUBBLE ANIMATIONS */
        .thought {
            animation: thoughtFade 0.6s ease-out;
        }
        @keyframes thoughtFade {
            from { opacity: 0; filter: blur(3px); }
            to { opacity: 1; filter: blur(0); }
        }

        /* 39. POETIC TEXT FLOAT */
        .poetic {
            animation: poeticFloat 4s ease-in-out infinite;
        }
        @keyframes poeticFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        /* 40. SPICY CONTENT GLOW */
        .spicy {
            position: relative;
            overflow: hidden;
        }
        .spicy::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(139,0,0,0.1), transparent);
            animation: spicyShine 5s ease-in-out infinite;
        }
        @keyframes spicyShine {
            0%, 100% { left: -100%; }
            50% { left: 150%; }
        }

        /* 41. LOADING SPINNER VARIATIONS */
        .spinner {
            width: 40px; height: 40px;
            border: 3px solid var(--smoke);
            border-top-color: var(--blood);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .spinner-dots {
            display: flex; gap: 5px;
        }
        .spinner-dot {
            width: 10px; height: 10px;
            background: var(--blood);
            border-radius: 50%;
            animation: dotPulse 1.4s ease-in-out infinite;
        }
        .spinner-dot:nth-child(2) { animation-delay: 0.2s; }
        .spinner-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dotPulse {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* 42. PROGRESS RING */
        .progress-ring {
            width: 60px; height: 60px;
            position: relative;
        }
        .progress-ring svg {
            transform: rotate(-90deg);
        }
        .progress-ring circle {
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
        }
        .progress-ring .bg { stroke: var(--smoke); }
        .progress-ring .progress {
            stroke: var(--blood);
            stroke-dasharray: 157;
            stroke-dashoffset: var(--progress, 157);
            transition: stroke-dashoffset 0.5s ease-out;
        }

        /* 43. BUTTON PRESS EFFECTS */
        button:active, .choice:active {
            transform: scale(0.98);
            filter: brightness(0.9);
        }

        /* 44. INPUT FOCUS EFFECTS */
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--blood);
            box-shadow: 0 0 20px var(--blood-glow);
        }
        input, textarea {
            background: var(--ash);
            border: 1px solid var(--smoke);
            color: var(--bone);
            padding: 10px 15px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        /* 45. MODAL SLIDE ANIMATIONS */
        .modal {
            animation: modalSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes modalSlide {
            from { opacity: 0; transform: translateY(-50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* 46. PANEL SLIDE-IN */
        .panel-slide {
            animation: panelSlide 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes panelSlide {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* 47. STATS BAR FILLS */
        .stat-bar {
            height: 8px;
            background: var(--smoke);
            border-radius: 4px;
            overflow: hidden;
        }
        .stat-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .stat-bar-fill.courage { background: linear-gradient(90deg, #ff6b6b, #ee5a5a); }
        .stat-bar-fill.compassion { background: linear-gradient(90deg, #4ecdc4, #3db9b0); }
        .stat-bar-fill.pragmatism { background: linear-gradient(90deg, #ffd93d, #ffcd1d); }
        .stat-bar-fill.isolation { background: linear-gradient(90deg, #6c5ce7, #5b4cdb); }

        /* 48. ACHIEVEMENT UNLOCK */
        .unlock-burst {
            position: fixed;
            top: 50%; left: 50%;
            width: 200px; height: 200px;
            margin: -100px 0 0 -100px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--blood) 0%, transparent 70%);
            animation: burstOut 1s ease-out forwards;
            pointer-events: none;
            z-index: 600;
        }
        @keyframes burstOut {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(5); opacity: 0; }
        }

        /* 49. SNOW EFFECT */
        .snow-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 20;
        }
        .snowflake {
            position: absolute;
            top: -10px;
            width: 6px; height: 6px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: snowFall linear infinite;
            box-shadow: 0 0 5px rgba(255,255,255,0.5);
        }
        @keyframes snowFall {
            to { transform: translateY(100vh) translateX(20px); }
        }

        /* 50. END CREDITS SCROLL */
        .credits {
            position: fixed;
            bottom: 0; left: 0;
            width: 100%; height: 100%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            pointer-events: none;
            z-index: 200;
        }
        .credits-text {
            text-align: center;
            animation: creditsScroll 60s linear;
        }
        @keyframes creditsScroll {
            from { transform: translateY(100vh); }
            to { transform: translateY(-200vh); }
        }

        /* RESPONSIVE ADJUSTMENTS */
        @media (max-width: 768px) {
            .mongoose-controls { bottom: 70px; }
            .toast-container { bottom: 120px; right: 10px; left: 10px; }
            .toast { font-size: 0.85em; }
        }

        /* DEBUG OVERLAY STYLES */
        .debug-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 100000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalSlide 0.3s ease-out;
        }
        .debug-panel {
            background: linear-gradient(180deg, rgba(30,20,20,0.98), rgba(10,5,5,0.98));
            border: 2px solid var(--blood);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .debug-panel h2 {
            font-family: 'Cinzel', serif;
            color: var(--blood);
            margin-bottom: 20px;
            text-align: center;
        }
        .debug-panel h3 {
            color: rgba(255,255,255,0.5);
            font-size: 0.8em;
            margin: 20px 0 10px;
            letter-spacing: 2px;
        }
        .debug-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .debug-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .debug-row label {
            flex: 1;
            color: var(--bone);
        }
        .debug-row input {
            width: 80px;
        }
        .debug-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #666;
            font-size: 2em;
            cursor: pointer;
        }
        .debug-panel button {
            background: var(--ash);
            border: 1px solid var(--blood);
            color: var(--bone);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Space Mono', monospace;
            font-size: 0.85em;
        }
        .debug-panel button:hover {
            background: var(--blood);
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-text">INITIALIZING</div>
    </div>

    <div class="scanlines"></div>
    <div class="vignette"></div>
    <div class="blood-drip"></div>
    <div class="film-grain"></div>
    <div class="reading-progress" id="reading-progress"></div>
    <div class="parallax-bg"></div>
    <div class="particles" id="particles"></div>
    <div class="toast-container" id="toast-container"></div>

    <div class="game-container">
        <header class="header">
            <div class="title-small">DEAD SEOUL</div>
            <div class="progress-indicator" id="progress">SEC 01</div>
        </header>

        <main class="content" id="content">
            <!-- Sections injected by JavaScript -->
        </main>

        <div class="thread-indicator">
            <div class="thread" id="thread-yuna" title="Yuna"></div>
            <div class="thread" id="thread-minho" title="Minho"></div>
            <div class="thread" id="thread-soojin" title="Soojin"></div>
            <div class="thread" id="thread-yoo" title="Colonel Yoo"></div>
        </div>
    </div>

    <script>
        // Injected from server - no hardcoded secrets
        window.ADMIN_CODE = '{{ admin_code }}';
    </script>
    <script src="/static/story_data.js"></script>
    <script src="/static/mongoose_engine.js"></script>
    <script src="/static/procedural_engine.js"></script>
    <script src="/static/adaptive_engine.js"></script>
    <script src="/static/audio_engine.js"></script>
    <script src="/static/easter_eggs.js"></script>
    <script src="/static/jin_intensity.js"></script>
    <script src="/static/snow_globes.js"></script>
    <script src="/static/life_moments.js"></script>
    <script src="/static/jin_thread.js"></script>
    <script src="/static/characters.js"></script>
    <script src="/static/cognitive_layer.js"></script>
    <script>
        // DEAD SEOUL - Interactive CYOA Engine
        // Black Mirror √ó Blue Bedlam √ó Ritchie Cascade

        const GAME_DATA = {
            // Section 1: THE LAST MORNING
            1: {
                title: "THE LAST MORNING",
                thread: "yuna",
                media: { type: "image", src: "/static/media/images/seoul_burning.jpg", alt: "Seoul skyline engulfed in flames" },
                content: `
                    <p class="narrative">The morning Seoul dies, you wake up late for work.</p>

                    <p class="narrative">Your phone shows seventeen missed calls from an unknown number. Three from your mother. The television‚Äîyou don't remember leaving it on‚Äîshows a news anchor crying.</p>

                    <p class="dialogue">"‚Äîadvised to stay indoors. Do not approach anyone exhibiting symptoms. The infection spreads through‚Äî"</p>

                    <p class="narrative">Static.</p>

                    <p class="narrative">Outside your window, Hongdae is burning. A helicopter spirals into the Han River like a signal bouncing off dead satellites‚Äîstill transmitting to a frequency no one monitors anymore. And in the street five floors below, something that used to be a woman is doing something unspeakable to something that used to be a man.</p>

                    <p class="narrative">Your phone buzzes. Unknown number. You answer.</p>

                    <p class="dialogue">"Yuna." That voice. The one that still makes your stomach drop. "Where are you? Are you safe?"</p>

                    <p class="narrative">Minho. After six months of silence. Calling now.</p>

                    <p class="dialogue">"I'm‚ÄîI'm in my apartment. Minho, what's‚Äî"</p>

                    <p class="dialogue">"Listen to me. Don't go outside. Barricade your door. I'm coming for you." A crash. Screaming in the background. "I'm in Itaewon. I can be there in‚Äî"</p>

                    <p class="narrative">The line dies.</p>

                    <p class="narrative">He's coming for you. After everything. After the silence and the distance and the way he broke you like matter burning up on entry‚Äîbrief and brilliant, making someone's wish real at the cost of its own light.</p>

                    <p class="narrative thought">He's <em>coming for you</em>.</p>

                    <p class="narrative">Something hot and complicated moves through your chest. You don't have time to name it.</p>

                    <p class="narrative">The pounding starts on Mrs. Park's door down the hall.</p>
                `,
                choices: [
                    { text: "Help Mrs. Park. You can't leave an old woman to die.", target: 2 },
                    { text: "Barricade your door. Survival first. Minho said stay.", target: 3 },
                    { text: "Grab a weapon and go. Don't wait to be saved.", target: 4 }
                ]
            },

            // Section 2: THE NEIGHBOR
            2: {
                title: "THE NEIGHBOR",
                thread: "yuna",
                content: `
                    <p class="narrative">You run to Mrs. Park's door.</p>

                    <p class="narrative">The wood is already splintering. Whatever's on the other side is <em>strong</em>.</p>

                    <p class="dialogue">"Mrs. Park! It's Yuna!"</p>

                    <p class="narrative">The door cracks open. A wrinkled hand grabs your wrist with shocking force and yanks you inside. Mrs. Park‚Äîeighty-three, widowed, the woman who brings you soup when you work late‚Äîslams the door shut.</p>

                    <p class="narrative">She's holding a fire extinguisher like a weapon. Her eyes are steady.</p>

                    <p class="dialogue">"I was in the war, girl. The real one. I've seen worse."</p>

                    <p class="narrative">The door shudders. Won't hold.</p>

                    <p class="dialogue">"Fire escape," she says. "My hip won't make the climb. You go."</p>

                    <p class="dialogue">"I'm not leaving you."</p>

                    <p class="dialogue">"Yes you are." She presses something into your palm. A key. "Storage unit in Yeouido. My husband's emergency supplies. He was paranoid about the North." She smiles, savage and ancient. "Take it. Survive. Make them pay for every inch."</p>

                    <div class="poetic">
                        Binary stars orbit a center neither owns,<br>
                        locked in gravitational dance,<br>
                        too close to escape, too far to collide.<br>
                        You burned bright in that shared space.
                    </div>

                    <p class="narrative">The door breaks.</p>

                    <p class="narrative">She raises the extinguisher.</p>

                    <p class="dialogue"><strong>"GO."</strong></p>
                `,
                choices: [
                    { text: "Take the key and run. Honor her sacrifice.", target: 5 },
                    { text: "Stay and fight beside her. Together or not at all.", target: 6 }
                ]
            },

            // Section 3: THE BARRICADE
            3: {
                title: "THE BARRICADE",
                thread: "minho",
                content: `
                    <p class="narrative">You drag everything you own against the door. Bookshelf. Desk. Mattress.</p>

                    <p class="narrative">Then you wait.</p>

                    <p class="narrative">Three hours in the dark. The sounds outside are... you don't have words. You learn not to hear them. You learn to be very, very still.</p>

                    <p class="narrative">When the pounding comes, you freeze.</p>

                    <p class="dialogue">"Yuna? Yuna, are you there? It's me."</p>

                    <p class="narrative">Minho's voice. Through the door. Alive.</p>

                    <p class="narrative">You tear apart the barricade with shaking hands. When the door opens, he's covered in blood‚Äînot his, he swears‚Äîand his eyes are wild.</p>

                    <p class="narrative">But when he sees you, something in his face cracks open.</p>

                    <p class="dialogue">"You're alive," he breathes. "You're‚Äî"</p>

                    <p class="narrative">He doesn't finish. He crosses the room in two steps and his arms are around you, his face buried in your hair, his whole body shaking.</p>

                    <p class="dialogue">"I thought I lost you," he says. "I thought‚Äî"</p>

                    <p class="dialogue">"You left me." It comes out before you can stop it. Six months of hurt compressed into three words.</p>

                    <p class="narrative">He pulls back. Meets your eyes.</p>

                    <p class="dialogue">"I know. I know I did. And I'm sorry. I'm so fucking sorry." His hands come up to cup your face. Careful. Like you're something precious. "I was on my way back when it started. I had my resignation letter written. I was going to‚Äî"</p>

                    <p class="narrative">An explosion rocks the building.</p>

                    <p class="dialogue">"We have to move," he says. "Car's outside. There's a military safe zone in Bukhansan. We can talk there. We can‚Äî" He stops. His thumb traces your cheekbone. "Please. Just give me a chance to make this right."</p>
                `,
                choices: [
                    { text: "Go with him. Whatever happened before, he came back.", target: 7 },
                    { text: "Tell him you'll follow in your own way. Trust is earned.", target: 8 },
                    { text: "Kiss him first. If the world is ending, stop wasting time.", target: 9 }
                ]
            },

            // Section 4: THE HUNTER
            4: {
                title: "THE HUNTER",
                thread: "soojin",
                media: { type: "image", src: "/static/media/images/hallway.jpg", alt: "Flickering fluorescent lights in a bloody corridor" },
                content: `
                    <p class="narrative">You don't wait.</p>

                    <p class="narrative">You grab the knife from your kitchen‚Äîthe Japanese santoku your mother gave you‚Äîand slip into the hallway.</p>

                    <p class="narrative">The lights are flickering. Something is moving at the far end, hunched over something wet.</p>

                    <p class="narrative">It looks up. Its eyes are filmed white. Its mouth is red.</p>

                    <p class="narrative">It runs at you.</p>

                    <p class="narrative">You sidestep‚Äîmuscle memory from the self-defense classes you took after a man followed you home last year‚Äîand drive the knife into its temple.</p>

                    <p class="narrative">It drops.</p>

                    <p class="narrative">You stare at the blood on your hands. At the thing you just did.</p>

                    <p class="narrative thought">You don't feel guilty. That's what scares you.</p>

                    <p class="narrative thought">You feel <em>alive</em>.</p>

                    <p class="narrative">You make it to the stairwell. Three floors down, you find someone else: a woman, maybe thirty, fighting off two of them with a baseball bat. She moves like water‚Äîprecise, devastating.</p>

                    <p class="narrative">She sees you. Doesn't hesitate.</p>

                    <p class="dialogue">"Behind me. <em>Move.</em>"</p>

                    <p class="narrative">You move.</p>

                    <p class="narrative">Together, you carve through six more before reaching the street. She pulls you into an alley, then through a back door, into the storage room of a convenience store.</p>

                    <p class="dialogue">"Soojin," she says, catching her breath. "Former ROK Special Forces."</p>

                    <p class="dialogue">"Yuna. Museum curator."</p>

                    <p class="narrative">She looks you up and down. Cataloguing. Assessing.</p>

                    <p class="dialogue">"You handled that knife like you knew what you were doing."</p>

                    <p class="dialogue">"Beginner's luck."</p>

                    <p class="dialogue">"Bullshit." Something flickers in her eyes. Not quite a smile. "You've got instincts. That's rare."</p>
                `,
                choices: [
                    { text: "Ask about her plan. She clearly has one.", target: 10 },
                    { text: "\"What happened to you? The discharge.\"", target: 11 },
                    { text: "Say nothing. Just catch your breath. Let the silence speak.", target: 12 }
                ]
            },

            // Section 7: THE REUNION (Minho Spicy Route)
            7: {
                title: "THE REUNION",
                thread: "minho",
                content: `
                    <p class="narrative">You take his hand.</p>

                    <p class="narrative">The drive to Bukhansan is terrifying. Minho drives like a man possessed, weaving through burning streets, running over things you try not to see.</p>

                    <p class="dialogue">"I never stopped," he says, eyes on the road. "Loving you. I just forgot how to show it."</p>

                    <p class="dialogue">"I know."</p>

                    <p class="dialogue">"I was a coward. I was‚Äî"</p>

                    <p class="dialogue">"Minho. Focus on driving."</p>

                    <p class="narrative">Something almost like a smile crosses his face.</p>

                    <p class="narrative">You reach the safe zone at dawn. Fences, guards, tents‚Äîmaybe a thousand survivors.</p>

                    <p class="narrative">Inside, you're assigned a tent. Shared. Someone's sense of humor.</p>

                    <p class="narrative">Minho stands by the entrance, watching you. That intensity that used to make you forget how to breathe.</p>

                    <p class="dialogue">"I know I have to earn you back," he says quietly. "I know words aren't enough."</p>

                    <p class="dialogue">"Then stop talking."</p>

                    <p class="narrative">He crosses the distance between you.</p>

                    <div class="spicy">
                        <p class="narrative">His hands find your waist, pulling you against him. His mouth finds your jaw, your neck, the spot behind your ear that makes your knees weak.</p>

                        <p class="dialogue">"I've dreamed about this," he breathes against your skin. "Every night for six months."</p>

                        <p class="dialogue">"Me too."</p>

                        <p class="dialogue">"Tell me to stop." His hands slide lower. "Tell me to stop and I will."</p>

                        <p class="dialogue">"Don't you dare."</p>

                        <p class="narrative">He undresses you slowly. Not seductive‚Äîmethodical. Like he's unwrapping something precious and refusing to be rushed.</p>

                        <p class="dialogue">"I've thought about this," he says, fingers tracing your ribs. "Every inch of you. How I should have touched you. What I should have said."</p>

                        <p class="dialogue">"What should you have said?"</p>

                        <p class="narrative">His eyes meet yours. Dark, certain.</p>

                        <p class="dialogue">"Stay. I should have said stay. I should have said you were the only thing that mattered. I should have said‚Äî" He presses his forehead to yours. "I should have said I love you. Every day. Until you believed it."</p>

                        <p class="dialogue">"Say it now."</p>

                        <p class="dialogue">"I love you." His hands are on your hips, pulling you against him, and you can feel exactly how much he means it. "I love you. I love you. I'm going to spend the rest of this fucking apocalypse proving it."</p>

                        <p class="narrative">You kiss him to shut him up.</p>

                        <p class="narrative">It's not gentle. Six months of anger and want and unspent grief pouring out through teeth and tongue. His hands are in your hair, your nails are down his back, and when he finally lifts you and lowers you onto the narrow cot, you don't care that the canvas walls are thin.</p>

                        <p class="narrative thought">Let them hear.</p>

                        <p class="dialogue">"Look at me," he says, pushing inside you inch by devastating inch. "I want to see your eyes when you fall apart."</p>

                        <p class="narrative">You don't look away.</p>
                    </div>

                    <div class="poetic">
                        Now you're giving me permission to drift<br>
                        into someone else's gravity well,<br>
                        coaching my descent toward new moons,<br>
                        while I still write to you each day or night<br>
                        like a signal bouncing off dead satellites.
                    </div>

                    <p class="narrative">When it's over, you're wrapped around each other, sweaty and breathless. His fingers trace patterns on your shoulder.</p>

                    <p class="dialogue">"Stay," you whisper.</p>

                    <p class="dialogue">"I'm not going anywhere. Not ever again."</p>
                `,
                choices: [
                    { text: "Continue building this life with him.", target: 15 },
                    { text: "Wonder if you're making a mistake...", target: 8 }
                ]
            },

            // Section 9: THE KISS (Immediate Passion Ending)
            9: {
                title: "THE REKINDLED FLAME",
                thread: "minho",
                isEnding: true,
                endingNumber: 1,
                content: `
                    <p class="narrative">You kiss him.</p>

                    <p class="narrative">No warning. No preamble. You grab his collar and pull him down and take what you've wanted for six months.</p>

                    <p class="narrative">He freezes for half a second. Then his hands are on you, desperate, bruising, and he's kissing you back like you're the only oxygen in a burning world.</p>

                    <p class="dialogue">"Yuna‚Äî"</p>

                    <p class="dialogue">"Shut up." You're already pulling at his jacket. "The world is ending. I'm not wasting another second."</p>

                    <div class="spicy">
                        <p class="narrative">You don't make it to the safe zone that night.</p>

                        <p class="narrative">You pull him into an abandoned apartment, barricade the door, and take what you're owed.</p>

                        <p class="narrative">He pushes you against the wall, his mouth on your throat, his hands everywhere.</p>

                        <p class="dialogue">"I should apologize‚Äî"</p>

                        <p class="dialogue">"Later."</p>

                        <p class="dialogue">"I should explain‚Äî"</p>

                        <p class="dialogue">"<em>Later.</em>"</p>

                        <p class="dialogue">"I love you," he says, and swallows your response with another kiss.</p>
                    </div>

                    <p class="narrative">When you finally reach Bukhansan, three days later, you're different. The distance between you has closed. The silence has been filled‚Äîwith words, with skin, with promises made in the dark.</p>

                    <div class="ending">
                        <div class="ending-number">ENDING 1 OF 8</div>
                        <h2 class="ending-title">THE REKINDLED FLAME</h2>
                        <div class="ending-text">
                            <p>The world ended. But you found each other in the ashes.</p>
                            <p>Six months later, you lead supply runs together. He follows you into danger without question. You follow him out.</p>
                            <p>And every night, in the tent that's become yours, he proves what he couldn't say before:</p>
                            <p><em>"I choose you. Every time. I choose you."</em></p>
                        </div>
                        <button class="restart-btn" onclick="restartGame()">BEGIN AGAIN</button>
                    </div>
                `,
                choices: []
            },

            // Section 11: HER LOSS (Soojin Spicy Route)
            11: {
                title: "HER LOSS",
                thread: "soojin",
                content: `
                    <p class="narrative">At 3 AM, she speaks into the darkness:</p>

                    <p class="dialogue">"I was discharged for loving my CO. She didn't love me back the same way. At least, not publicly." A pause. "She was in Busan when this started."</p>

                    <p class="dialogue">"Her loss," you say.</p>

                    <p class="narrative">Soojin laughs‚Äîbitter, surprised.</p>

                    <p class="dialogue">"You're the first person who's ever said that. Everyone else said 'that's too bad' or 'you should have been more careful.'"</p>

                    <p class="dialogue">"Those people are idiots. And probably dead now."</p>

                    <p class="narrative">She laughs again. This time it sounds real.</p>

                    <p class="dialogue">"You're not what I expected," she says. "Most people I rescue... they break."</p>

                    <p class="dialogue">"My father was in the Navy. He taught me something." You meet her eyes. "Fear is just love holding its breath."</p>

                    <div class="poetic">
                        Through a tangled tapestry,<br>
                        dances a threaded needle,<br>
                        fate nudged this way and that,<br>
                        life is ever winding and woven,<br>
                        paths are joined and broken,<br>
                        connections are made,<br>
                        even when words aren't spoken.
                    </div>

                    <p class="narrative">She's quiet for a long moment.</p>

                    <p class="dialogue">"I like that," she finally says. "I'm going to steal it."</p>

                    <p class="dialogue">"It's not stealing if I give it to you."</p>

                    <p class="narrative">The silence between you changes. Thickens.</p>

                    <p class="narrative">She moves first‚Äîor maybe you do. It doesn't matter. Her mouth finds yours in the dark, hungry and certain.</p>

                    <p class="dialogue">"Tell me to stop," she breathes.</p>

                    <p class="narrative">You pull her closer.</p>

                    <div class="spicy">
                        <p class="narrative">She kisses like she fights: no wasted motion, every touch intentional.</p>

                        <p class="dialogue">"I don't do this," she says, pulling back. "Random hookups in the apocalypse. This isn't‚Äî"</p>

                        <p class="dialogue">"Then what is it?"</p>

                        <p class="narrative">Her eyes are silver in the darkness. "I don't know. But I want to find out."</p>

                        <p class="narrative">She pushes you down onto the pile of blankets she'd arranged as a bed. Her hands are calloused, capable, and when they slide under your shirt, you gasp.</p>

                        <p class="dialogue">"Sensitive," she murmurs. Not a question.</p>

                        <p class="dialogue">"Shut up."</p>

                        <p class="narrative">She grins. Wolfish. "Make me."</p>

                        <p class="narrative">You try. You fail. She's stronger, faster, and she uses every advantage ruthlessly.</p>

                        <p class="narrative">But she's also careful. She pauses at every new inch of skin, checks your eyes, waits for permission.</p>

                        <p class="dialogue">"This okay?"</p>

                        <p class="dialogue">"<em>Yes.</em>"</p>

                        <p class="dialogue">"This?"</p>

                        <p class="dialogue">"<em>Yes.</em>"</p>

                        <p class="dialogue">"And this‚Äî" Her hand slides between your thighs. "This okay too?"</p>

                        <p class="narrative">You answer with your body.</p>

                        <p class="narrative">She takes her time. Learns you. Catalogues every sound you make like tactical intelligence.</p>

                        <p class="narrative">When you finally break apart, gasping her name, she watches you through it with something like wonder.</p>

                        <p class="dialogue">"Beautiful," she says. "Fucking beautiful."</p>

                        <p class="dialogue">"Your turn."</p>

                        <p class="dialogue">"You don't have to‚Äî"</p>

                        <p class="dialogue">"I want to." You push yourself up. Push her down. "Lie back and let me."</p>

                        <p class="narrative">She hesitates‚Äîjust for a second. Then something in her relaxes.</p>

                        <p class="dialogue">"Okay," she whispers. "Okay."</p>
                    </div>

                    <p class="narrative">When dawn comes, you're tangled together, her arm heavy across your waist.</p>

                    <p class="dialogue">"Stay," she says.</p>

                    <p class="narrative">You're not sure if she means right now or forever.</p>

                    <p class="narrative">You decide it doesn't matter.</p>

                    <p class="dialogue">"I'm staying."</p>
                `,
                choices: [
                    { text: "Head to Japan together.", target: 19 },
                    { text: "Ask about going back for her ex.", target: 10 }
                ]
            },

            // Section 18: COLONEL YOO (WLW Authority Figure Route)
            18: {
                title: "THE CHOICE",
                thread: "yoo",
                content: `
                    <p class="narrative">You kiss her.</p>

                    <p class="narrative">She tastes like adrenaline and authority. Her hand tightens in your hair‚Äînot gentle, not asking‚Äîand she walks you backward until you hit the tent's center pole.</p>

                    <p class="dialogue">"Decisive," she murmurs against your mouth. "Good."</p>

                    <p class="dialogue">"Less talking."</p>

                    <p class="dialogue">"Ordering me around?" She bites your lower lip. Hard enough to sting. "Brave."</p>

                    <div class="spicy">
                        <p class="narrative">Her hands are everywhere‚Äîpulling at your clothes, mapping your body with military precision. She knows what she's doing. She knows exactly where to touch.</p>

                        <p class="dialogue">"This is just tonight," she says, pulling back. Her eyes are dark. "You understand that."</p>

                        <p class="dialogue">"I understand."</p>

                        <p class="dialogue">"And Minho?"</p>

                        <p class="dialogue">"Isn't here."</p>

                        <p class="narrative">She grins. It's predatory and beautiful.</p>

                        <p class="dialogue">"Then let me show you what you've been missing."</p>

                        <p class="narrative">She's not gentle. She doesn't apologize for it. Every touch is a demand: <em>give me this. Show me that. Let go.</em></p>

                        <p class="narrative">When you finally break apart, she watches you with satisfaction.</p>

                        <p class="dialogue">"Again," you gasp.</p>

                        <p class="dialogue">"Say please."</p>

                        <p class="narrative">You glare at her.</p>

                        <p class="narrative">She laughs‚Äîgenuine, surprised. "I like you," she says. "Yuna the museum curator." Her fingers trace down your stomach. "Since you asked so nicely..."</p>
                    </div>

                    <p class="narrative">You don't sleep.</p>

                    <p class="narrative">In the morning, she's gone. A note on your pillow:</p>

                    <p class="dialogue"><em>Same time tomorrow. If you want.<br>‚ÄîY.</em></p>

                    <p class="narrative">You fold the note carefully. Tuck it into your pocket.</p>

                    <p class="narrative">When Minho finds you at breakfast, he looks at you like he's seeing something new.</p>

                    <p class="dialogue">"You seem different," he says.</p>

                    <p class="dialogue">"Different how?"</p>

                    <p class="dialogue">"I don't know." He studies you. "More... certain."</p>

                    <p class="narrative">You smile. Don't explain.</p>

                    <p class="narrative thought">Some things don't need explaining.</p>
                `,
                choices: [
                    { text: "Keep seeing her in secret.", target: 23 },
                    { text: "Tell Minho. See what happens.", target: 23 }
                ]
            },

            // Section 19: THE CROSSING (Japan with Soojin)
            19: {
                title: "THE NEW LIFE",
                thread: "soojin",
                isEnding: true,
                endingNumber: 4,
                content: `
                    <p class="narrative">The boat to Japan is everything Soojin promised: small, fast, dangerous.</p>

                    <p class="narrative">You fight off infected at the docks. You navigate through storms. You hold each other through the crossing.</p>

                    <p class="narrative">Japan is real. Japan is alive.</p>

                    <p class="narrative">At the quarantine checkpoint, they ask your relationship.</p>

                    <p class="narrative">Soojin looks at you. You look at her.</p>

                    <p class="dialogue">"Partners," she says.</p>

                    <p class="narrative">It sounds right.</p>

                    <p class="narrative">Three months later, she gets word: Soyeon is alive. In a camp in Jeju. She wants Soojin to come back.</p>

                    <p class="narrative">Your heart drops. "That's wonderful."</p>

                    <p class="dialogue">"I told her no."</p>

                    <p class="dialogue">"Why?"</p>

                    <p class="dialogue">"Because I'm already with someone."</p>

                    <p class="narrative">She crosses the distance between you. Takes your face in her hands.</p>

                    <p class="dialogue">"I love you," she says. "I've been trying to figure out how to say it. Apparently the best I could manage is 'I chose you over the woman I spent years pining for.'"</p>

                    <p class="narrative">You laugh. It's wet and messy and perfect.</p>

                    <p class="dialogue">"That's the most romantic thing anyone's ever said to me."</p>

                    <p class="dialogue">"I'm not a romantic person."</p>

                    <p class="dialogue">"You are for me."</p>

                    <div class="ending">
                        <div class="ending-number">ENDING 4 OF 8</div>
                        <h2 class="ending-title">THE NEW LIFE</h2>
                        <div class="ending-text">
                            <p>You build a life in Japan. Quiet. Ordinary. Extraordinary.</p>
                            <p>Soojin learns to laugh. You learn to fight. Together, you become something neither of you expected:</p>
                            <p><em>A home.</em></p>
                        </div>
                        <button class="restart-btn" onclick="restartGame()">BEGIN AGAIN</button>
                    </div>
                `,
                choices: []
            },

            // Section 23: THE POLY ENDING
            23: {
                title: "THE THROUPLE",
                thread: "yoo",
                isEnding: true,
                endingNumber: 6,
                content: `
                    <p class="narrative">It takes a month before Minho realizes something's different.</p>

                    <p class="narrative">It takes two before he confronts you about it.</p>

                    <p class="dialogue">"Colonel Yoo," he says flatly. "You and Colonel Yoo."</p>

                    <p class="narrative">You don't lie. "Yes."</p>

                    <p class="dialogue">"How long?"</p>

                    <p class="dialogue">"Since the second night."</p>

                    <p class="narrative">He's quiet for a long moment. Then:</p>

                    <p class="dialogue">"Do you love her?"</p>

                    <p class="dialogue">"I don't know. I like her. She makes me feel... powerful."</p>

                    <p class="dialogue">"And me?"</p>

                    <p class="narrative">You cross to him. Take his hands.</p>

                    <p class="dialogue">"You make me feel loved. That's different. That's not less."</p>

                    <p class="narrative">He's struggling‚Äîyou can see it. The old Minho would have walked away. The old Minho would have made this about his pride.</p>

                    <p class="narrative">The new Minho looks at you.</p>

                    <p class="dialogue">"I don't know how to do this," he admits.</p>

                    <p class="dialogue">"Neither do I. But I'd rather figure it out than lose you."</p>

                    <p class="dialogue">"And her?"</p>

                    <p class="dialogue">"She's... interested. If you are."</p>

                    <p class="narrative">His eyebrows rise. "Interested in what?"</p>

                    <p class="dialogue">"In seeing if this can work. The three of us."</p>

                    <p class="narrative">He's silent for so long you think you've broken something irreparable.</p>

                    <p class="narrative">Then: "I'll talk to her."</p>

                    <div class="poetic">
                        All those shooting stars we counted:<br>
                        matter burning up on entry,<br>
                        brief and brilliant,<br>
                        making someone's wish real<br>
                        at the cost of its own light.
                    </div>

                    <p class="narrative">One year later. It's not easy. It's never easy.</p>

                    <p class="narrative">But somewhere between supply runs and strategy meetings and tangled limbs in a tent that's become too small, you figure it out.</p>

                    <p class="dialogue">"This is insane," Yoo says one night, sandwiched between you and Minho.</p>

                    <p class="dialogue">"Completely," he agrees.</p>

                    <p class="dialogue">"Absolutely," you add.</p>

                    <p class="narrative">She kisses you. Then him. "I like insane."</p>

                    <div class="ending">
                        <div class="ending-number">ENDING 6 OF 8</div>
                        <h2 class="ending-title">THE THROUPLE</h2>
                        <div class="ending-text">
                            <p>The world ended. But you found two people who made the ruins feel like home.</p>
                            <p>Minho gives you steadiness. Yoo gives you fire. Together, they give you everything.</p>
                            <p>And when people ask how it works‚Äîthe three of you, the mess, the impossibility‚Äîyou just smile.</p>
                            <p><em>"We chose each other. Every day. That's all it takes."</em></p>
                        </div>
                        <button class="restart-btn" onclick="restartGame()">BEGIN AGAIN</button>
                    </div>
                `,
                choices: []
            },

            // More sections would continue here...
            // Adding key connection points

            5: {
                title: "THE KEY",
                thread: "yuna",
                content: `
                    <p class="narrative">You run.</p>

                    <p class="narrative">The fire escape groans but holds. Behind you, you hear the fire extinguisher connect‚Äîonce, twice‚Äîand then nothing.</p>

                    <p class="narrative">Mrs. Park's key is cold in your palm.</p>

                    <p class="narrative">You make it to Yeouido by nightfall. The storage unit is exactly where she said. Inside: camping gear, MREs, a shortwave radio, and a locked case at the back.</p>

                    <p class="narrative">Three handguns. Full magazines.</p>

                    <p class="narrative thought">Her husband was <em>very</em> paranoid.</p>

                    <p class="narrative">The radio crackles. A voice‚Äîyoung, desperate.</p>

                    <p class="dialogue"><em>"If anyone can hear this, we're at Seoul Station. Forty survivors. Running out of supplies. Please‚Äîif you can help‚Äî"</em></p>

                    <p class="narrative">You have enough supplies for one person to last months. Or forty people to last days.</p>

                    <p class="narrative thought">Mrs. Park didn't save you so you could save yourself.</p>
                `,
                choices: [
                    { text: "Go to Seoul Station. Share what you have.", target: 13 },
                    { text: "Stay alone. Survive. Build something in the ruins.", target: 14 }
                ]
            },

            13: {
                title: "THE DISPATCHER",
                thread: "yuna",
                isEnding: true,
                endingNumber: 2,
                content: `
                    <p class="narrative">You go.</p>

                    <p class="narrative">Mrs. Park didn't save you so you could save yourself.</p>

                    <p class="narrative">Seoul Station is worse than you imagined: forty-three people crammed into a ticket office, barricaded with vending machines. The children are too quiet. The adults are losing hope.</p>

                    <p class="narrative">When you walk in with supplies, they stare at you like you're salvation.</p>

                    <p class="dialogue">"Who are you?" the leader asks‚Äîa former transit officer named Mr. Bae.</p>

                    <p class="dialogue">"Someone who got lucky."</p>

                    <p class="narrative">You stay. You organize. You build something.</p>

                    <p class="narrative">By spring, Seoul Station is the heart of a network‚Äîsurvivor groups connected by scavenged radios and dangerous supply runs.</p>

                    <p class="narrative">And somewhere along the way, you fall in love.</p>

                    <p class="narrative">Not with one person. With the work. With the impossible, stubborn act of keeping people alive.</p>

                    <div class="ending">
                        <div class="ending-number">ENDING 2 OF 8</div>
                        <h2 class="ending-title">THE DISPATCHER</h2>
                        <div class="ending-text">
                            <p>They call you the Dispatcher. The voice on the radio. The one who coordinates rescues and shares resources and refuses to let anyone die alone.</p>
                            <p>Years later, when they write the history of the Seoul Reclamation, they won't know your face.</p>
                            <p>But they'll quote your words:</p>
                            <p><em>"This is Dispatcher Yuna, Seoul Station. If you can hear this, you're not alone."</em></p>
                        </div>
                        <button class="restart-btn" onclick="restartGame()">BEGIN AGAIN</button>
                    </div>
                `,
                choices: []
            },

            15: {
                title: "THE SURVIVORS",
                thread: "minho",
                isEnding: true,
                endingNumber: 3,
                content: `
                    <p class="narrative">Three months in the safe zone. Three months of learning to be together again‚Äîreally together, not the shadow of a relationship you had before.</p>

                    <p class="narrative">He's different now. Softer in some ways, harder in others. He doesn't take anything for granted.</p>

                    <p class="dialogue">"I have nightmares," he admits one night, lying beside you. "About being too late. About finding your door broken open and‚Äî"</p>

                    <p class="dialogue">"I'm here." You press your palm to his chest. Feel his heart beating. "I'm here."</p>

                    <p class="narrative">When the call comes to lead a supply run, you both volunteer.</p>

                    <p class="dialogue">"You don't have to," he says. "You could stay‚Äî"</p>

                    <p class="dialogue">"We do this together or not at all."</p>

                    <p class="narrative">Something flickers in his eyes. Pride, maybe. Or love.</p>

                    <p class="dialogue">"Together," he agrees.</p>

                    <div class="ending">
                        <div class="ending-number">ENDING 3 OF 8</div>
                        <h2 class="ending-title">THE SURVIVORS</h2>
                        <div class="ending-text">
                            <p>You fight together. Build together. Lead together.</p>
                            <p>When the safe zone becomes a city, you're on the council. When the city becomes a nation, you're its founders.</p>
                            <p>And every night, in the home you built from nothing, he holds you like you're everything.</p>
                            <p><em>"I choose you," he whispers. "Forever. I choose you."</em></p>
                        </div>
                        <button class="restart-btn" onclick="restartGame()">BEGIN AGAIN</button>
                    </div>
                `,
                choices: []
            }
        };

        // Merge STORY_DATA from story_data.js into GAME_DATA
        if (typeof STORY_DATA !== "undefined") {
            Object.assign(GAME_DATA, STORY_DATA);
        }

        // Merge JIN_THREAD if available
        if (typeof JIN_THREAD !== "undefined") {
            Object.assign(GAME_DATA, JIN_THREAD);
        }

        // Game State
        let gameState = {
            currentSection: 1,
            history: [],
            endings: [],
            threadsVisited: new Set()
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== DEAD SEOUL INIT ===');
            console.log('GAME_DATA keys:', Object.keys(GAME_DATA).length);
            console.log('STORY_DATA exists:', typeof STORY_DATA !== 'undefined');
            console.log('Section 1:', GAME_DATA[1] ? 'EXISTS' : 'MISSING');

            try {
                // Load saved state
                const saved = {{ save_data | safe }};
                console.log('Saved data:', saved);

                if (saved && saved.currentSection) {
                    gameState = {
                        ...saved,
                        threadsVisited: new Set(saved.threadsVisited || [])
                    };
                }

                // Hide loading and render
                setTimeout(() => {
                    console.log('Hiding loading, rendering section:', gameState.currentSection);
                    document.getElementById('loading').classList.add('hidden');

                    // Inject stats UI if available
                    if (typeof generateStatsUI === 'function') {
                        document.body.insertAdjacentHTML('beforeend', generateStatsUI());
                    }

                    renderSection(gameState.currentSection);
                }, 1000);
            } catch (e) {
                console.error('Init error:', e);
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').innerHTML = `
                    <div class="section active" style="padding: 2rem; text-align: center;">
                        <h2 style="color: #8b0000;">Init Error</h2>
                        <p style="color: #fff;">${e.message}</p>
                        <pre style="color: #666; font-size: 0.8em; text-align: left; margin-top: 1rem;">${e.stack}</pre>
                        <button onclick="location.reload()" style="margin-top: 1rem; padding: 10px 20px; background: #8b0000; color: #fff; border: none; cursor: pointer;">Reload</button>
                    </div>
                `;
            }
        });

        // Nuclear fallback - if nothing renders after 3 seconds, show debug info
        setTimeout(() => {
            const content = document.getElementById('content');
            if (content && content.innerHTML.trim() === '') {
                console.error('NUCLEAR FALLBACK: Content empty after 3s');
                content.innerHTML = `
                    <div class="section active" style="padding: 2rem;">
                        <h2 style="color: #8b0000;">Debug: Content Empty</h2>
                        <p style="color: #fff;">GAME_DATA sections: ${Object.keys(GAME_DATA).length}</p>
                        <p style="color: #fff;">STORY_DATA: ${typeof STORY_DATA !== 'undefined' ? Object.keys(STORY_DATA).length + ' sections' : 'NOT LOADED'}</p>
                        <p style="color: #fff;">Section 1: ${GAME_DATA[1] ? 'exists' : 'MISSING'}</p>
                        <p style="color: #fff;">Current section: ${gameState.currentSection}</p>
                        <hr style="margin: 1rem 0; border-color: #333;">
                        <p style="color: #666;">Available sections: ${Object.keys(GAME_DATA).slice(0, 30).join(', ')}</p>
                        <button onclick="renderSection(1)" style="margin-top: 1rem; padding: 10px 20px; background: #8b0000; color: #fff; border: none; cursor: pointer;">Force Section 1</button>
                    </div>
                `;
            }
        }, 3000);

        function renderSection(sectionId) {
            const section = GAME_DATA[sectionId];
            if (!section) {
                console.error('Section not found:', sectionId);
                // Show error in UI instead of blank screen
                document.getElementById('content').innerHTML = `
                    <div class="section active" style="padding: 2rem; text-align: center;">
                        <h2 style="color: var(--blood);">Section ${sectionId} not found</h2>
                        <p>Available sections: ${Object.keys(GAME_DATA).slice(0, 20).join(', ')}...</p>
                        <p style="margin-top: 1rem; color: #666;">Total sections loaded: ${Object.keys(GAME_DATA).length}</p>
                        <button class="restart-btn" onclick="renderSection(1)" style="margin-top: 2rem;">Try Section 1</button>
                    </div>
                `;
                return;
            }

            gameState.currentSection = sectionId;
            gameState.threadsVisited.add(section.thread);

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // ENGINE HOOKS - Analytics, Audio, Adaptive
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            // Track section view
            if (typeof Analytics !== 'undefined') {
                Analytics.viewSection(sectionId, section.title);
            }

            // Trigger audio based on content
            if (typeof AudioEngine !== 'undefined') {
                AudioEngine.onSectionEnter(sectionId, section.content);
            }

            // Get mongoose engine state
            const mongooseState = typeof MongooseEngine !== 'undefined' ? MongooseEngine.state : { jinTrust: 0, loyalty: 0, playthrough: 1 };

            // Update progress indicator
            document.getElementById('progress').textContent =
                section.isEnding ? 'END' : `SEC ${String(sectionId).padStart(2, '0')}`;

            // Update thread indicators
            updateThreads();

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // CONTENT MUTATION - Easter eggs, Jin intensity, NG+ flavor
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            let content = section.content;

            // Mongoose engine content mutation (NG+ deja vu, Jin trust flavor)
            if (typeof MongooseEngine !== 'undefined') {
                content = MongooseEngine.mutateContent(content, sectionId);
            }

            // Jin intensity injection (if Jin scene and high trust)
            if (typeof JinIntensity !== 'undefined' && content.toLowerCase().includes('jin')) {
                content = JinIntensity.injectIntensity(content, mongooseState.jinTrust);
            }

            // Easter egg injection (10% chance for TLOU references)
            if (typeof EasterEggs !== 'undefined') {
                const sectionType = detectSectionType(content);
                content = EasterEggs.maybeInject(content, sectionType);
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // LIFE MOMENTS - Dreamcatcher, Crystal, Tattoos
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            // First Jin meeting - give dreamcatcher
            if (typeof LifeMoments !== 'undefined') {
                if (isFirstJinMeeting(sectionId, content) && LifeMoments.shouldGiveDreamcatcher(sectionId, true)) {
                    content += LifeMoments.dreamcatcher.content;
                    LifeMoments.awardDreamcatcher();
                }

                // Crystal necklace discovery (GUARANTEED at trust threshold)
                if (mongooseState.jinTrust >= 8 && !localStorage.getItem('mongoose_crystal_found')) {
                    content += LifeMoments.crystalNecklace.discovery.content;
                    localStorage.setItem('mongoose_crystal_found', 'true');
                }

                // Crystal giving scene (after discovery, on next Jin scene)
                if (localStorage.getItem('mongoose_crystal_found') && !localStorage.getItem('mongoose_crystal_given')) {
                    if (content.toLowerCase().includes('jin') && mongooseState.jinTrust >= 9) {
                        content += LifeMoments.crystalNecklace.giving.content;
                        localStorage.setItem('mongoose_crystal_given', 'true');
                    }
                }

                // Tattoo scene (GUARANTEED at high trust)
                if (mongooseState.jinTrust >= 12 && !localStorage.getItem('mongoose_tattoo_offered')) {
                    content += LifeMoments.tattoos.discovery.content;
                    localStorage.setItem('mongoose_tattoo_offered', 'true');
                }

                // Tattoo completion (after accepting)
                if (localStorage.getItem('mongoose_tattoo_accepted') && !localStorage.getItem('mongoose_tattoo_done')) {
                    content += LifeMoments.tattoos.gettingInked.content;
                    localStorage.setItem('mongoose_tattoo_done', 'true');
                }

                // Safeword establishment (GUARANTEED at trust 10)
                if (mongooseState.jinTrust >= 10 && !localStorage.getItem('mongoose_safewords_set')) {
                    content += LifeMoments.safewords.establishment.content;
                    localStorage.setItem('mongoose_safewords_set', 'true');
                }

                // Hot spring scene (GUARANTEED at trust 11)
                if (mongooseState.jinTrust >= 11 && !localStorage.getItem('mongoose_hotspring')) {
                    content += LifeMoments.hotspring.discovery.content;
                    localStorage.setItem('mongoose_hotspring', 'true');
                }

                // Jet ski scene (GUARANTEED at trust 7)
                if (mongooseState.jinTrust >= 7 && !localStorage.getItem('mongoose_jetski')) {
                    content += LifeMoments.jetski.discovery.content;
                    localStorage.setItem('mongoose_jetski', 'true');
                }
            }

            // Build section HTML
            let html = `
                <div class="section active" id="section-${sectionId}">
                    <div class="section-number">SECTION ${sectionId}</div>
                    <h2 class="section-title">${section.title}</h2>
            `;

            // Add media if present
            if (section.media) {
                if (section.media.type === 'image') {
                    html += `
                        <div class="media-container">
                            <img src="${section.media.src}" alt="${section.media.alt}"
                                 onerror="this.style.display='none'">
                        </div>
                    `;
                } else if (section.media.type === 'video') {
                    html += `
                        <div class="media-container">
                            <video src="${section.media.src}" autoplay muted loop playsinline></video>
                        </div>
                    `;
                }
            }

            // Add mutated content
            html += content;

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // DYNAMIC CHOICES - Mongoose pools, Adaptive choices, Intensity
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            let choices = section.choices || [];

            // Get dynamic choices from Mongoose Engine
            if (typeof MongooseEngine !== 'undefined') {
                const dynamicChoices = MongooseEngine.getChoicesForSection(sectionId);
                if (dynamicChoices) {
                    choices = dynamicChoices;
                }
            }

            // Adaptive choice generation removed - using positive reinforcement instead

            // Add dark romance choices if appropriate
            if (typeof DarkRomanceChoices !== 'undefined' && content.toLowerCase().includes('jin')) {
                const intensityChoices = DarkRomanceChoices.getIntensityChoices(mongooseState.jinTrust);
                if (intensityChoices.length > 0 && choices.length > 0) {
                    // Add one intensity choice to the mix
                    choices.push(intensityChoices[0]);
                }
            }

            // Add choices if not ending
            if (choices && choices.length > 0) {
                html += `
                    <div class="choices">
                        <div class="choices-header">What do you do?</div>
                `;

                choices.forEach((choice, index) => {
                    const target = choice.target || choice.next || (sectionId + 1);
                    const choiceData = encodeURIComponent(JSON.stringify(choice));
                    html += `
                        <button class="choice" onclick="makeChoice(${target}, '${choiceData}')">
                            ${choice.text}
                        </button>
                    `;
                });

                html += `</div>`;
            }

            html += `</div>`;

            // Render
            document.getElementById('content').innerHTML = html;
            document.getElementById('content').scrollTop = 0;

            // Save state
            saveGame();

            // Update stats display
            updateStatsDisplay();
        }

        // Detect section type for easter egg injection
        function detectSectionType(content) {
            const lower = content.toLowerCase();
            if (lower.includes('infected') || lower.includes('danger') || lower.includes('run')) return 'danger';
            if (lower.includes('found') || lower.includes('supplies') || lower.includes('search')) return 'loot';
            if (lower.includes('bite') || lower.includes('turning') || lower.includes('click')) return 'infected';
            if (lower.includes('quiet') || lower.includes('peace') || lower.includes('safe')) return 'peace';
            if (lower.includes('faction') || lower.includes('group') || lower.includes('territory')) return 'factions';
            return 'general';
        }

        // Check if this is the first Jin meeting
        function isFirstJinMeeting(sectionId, content) {
            const lower = content.toLowerCase();
            const hasJin = lower.includes('jin');
            const isIntro = lower.includes('first') || lower.includes('meet') || lower.includes('who are you');
            const notMet = !localStorage.getItem('mongoose_met_jin');

            if (hasJin && isIntro && notMet) {
                localStorage.setItem('mongoose_met_jin', 'true');
                return true;
            }
            return false;
        }

        // Update stats display
        function updateStatsDisplay() {
            const statsEl = document.getElementById('mongoose-stats');
            if (!statsEl) return;

            const state = typeof MongooseEngine !== 'undefined' ? MongooseEngine.state : { loyalty: 0, jinTrust: 0, playthrough: 1 };

            statsEl.innerHTML = `
                <div class="stat-item">‚ù§Ô∏è ${state.loyalty}</div>
                <div class="stat-item">üíï ${state.jinTrust}</div>
                <div class="stat-item">üîÑ NG${state.playthrough > 1 ? '+' + (state.playthrough - 1) : ''}</div>
            `;
        }

        function makeChoice(targetSection, choiceDataEncoded) {
            // Decode choice data if provided
            let choiceData = {};
            if (choiceDataEncoded) {
                try {
                    choiceData = JSON.parse(decodeURIComponent(choiceDataEncoded));
                } catch (e) {
                    console.warn('Could not parse choice data');
                }
            }

            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // ENGINE HOOKS - Record choice, learn, track
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            // Record in Mongoose Engine (updates loyalty, jinTrust, betrayals)
            if (typeof MongooseEngine !== 'undefined') {
                MongooseEngine.recordChoice(gameState.currentSection, choiceData);
            }

            // Reward positive choices (encourages loyalty, romance, courage)
            if (typeof AdaptiveEngine !== 'undefined') {
                AdaptiveEngine.reward({
                    chosenOption: choiceData
                });
            }

            // Track choice analytics
            if (typeof Analytics !== 'undefined') {
                Analytics.trackChoice(gameState.currentSection, targetSection, choiceData.text || 'unknown');
            }

            gameState.history.push(gameState.currentSection);
            renderSection(targetSection);

            // Check for ending
            const section = GAME_DATA[targetSection];
            if (section && section.isEnding) {
                gameState.endings.push(section.endingNumber);

                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                // ENDING REWARDS - Snow globes, seeds, analytics
                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

                // Award snow globe for this ending
                if (typeof SnowGlobeCollection !== 'undefined') {
                    SnowGlobeCollection.onEnding(section.endingNumber, section.endingCode);
                }

                // Track ending analytics
                if (typeof Analytics !== 'undefined') {
                    Analytics.trackEnding(section.endingNumber, section.title);
                }

                // Deliver seed if available
                if (typeof deliverSeed === "function" && typeof generateSeed === "function") {
                    const seed = generateSeed(section.endingNumber);
                    setTimeout(() => deliverSeed(section, gameState, seed), 1500);
                }

                // Generate procedural seed for sharing
                if (typeof ProceduralEngine !== 'undefined' && typeof MongooseEngine !== 'undefined') {
                    const fullSeed = ProceduralEngine.encodeSeed({
                        endingCode: section.endingCode || 'END' + section.endingNumber,
                        loyalty: MongooseEngine.state.loyalty,
                        jinTrust: MongooseEngine.state.jinTrust,
                        betrayals: MongooseEngine.state.betrayals,
                        playthrough: MongooseEngine.state.playthrough,
                        timeSpent: Date.now() - (window.sessionStart || Date.now()),
                        keyChoices: gameState.history.slice(0, 10)
                    });
                    console.log('Your seed:', fullSeed);
                    localStorage.setItem('mongoose_last_seed', fullSeed);
                }

                saveGame();
            }
        }

        function updateThreads() {
            const threads = ['yuna', 'minho', 'soojin', 'yoo'];
            const currentThread = GAME_DATA[gameState.currentSection]?.thread;

            threads.forEach(thread => {
                const el = document.getElementById(`thread-${thread}`);
                el.classList.remove('active', 'visited');

                if (thread === currentThread) {
                    el.classList.add('active');
                } else if (gameState.threadsVisited.has(thread)) {
                    el.classList.add('visited');
                }
            });
        }

        function saveGame() {
            const saveData = {
                ...gameState,
                threadsVisited: Array.from(gameState.threadsVisited)
            };

            // Save to server
            fetch('/api/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(saveData)
            });

            // Also save to localStorage as backup
            localStorage.setItem('deadseoul_save', JSON.stringify(saveData));
        }

        function restartGame() {
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // NEW GAME+ - Carry over progress
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

            let ngPlusMessage = null;

            if (typeof MongooseEngine !== 'undefined') {
                ngPlusMessage = MongooseEngine.startNewGamePlus();
            }

            gameState = {
                currentSection: 1,
                history: [],
                endings: gameState.endings, // Keep endings unlocked
                threadsVisited: new Set()
            };

            // Show NG+ message if applicable
            if (ngPlusMessage && ngPlusMessage.playthrough > 1) {
                showNGPlusMessage(ngPlusMessage);
            }

            saveGame();
            renderSection(1);
        }

        function showNGPlusMessage(ngPlus) {
            const overlay = document.createElement('div');
            overlay.className = 'ngplus-overlay';
            overlay.innerHTML = `
                <div class="ngplus-content">
                    <div class="ngplus-cycle">CYCLE ${ngPlus.playthrough}</div>
                    <div class="ngplus-message">${ngPlus.message}</div>
                    <div class="ngplus-carryover">
                        <span>‚ù§Ô∏è ${ngPlus.carryover.loyalty} loyalty carried</span>
                        <span>üíï ${ngPlus.carryover.jinTrust} trust remembered</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()">CONTINUE</button>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI ELEMENTS - Stats, Globes, Audio, Menu
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function initUI() {
            // Stats display
            const stats = document.createElement('div');
            stats.id = 'mongoose-stats';
            stats.className = 'mongoose-stats';
            document.body.appendChild(stats);

            // Control buttons
            const controls = document.createElement('div');
            controls.className = 'mongoose-controls';
            controls.innerHTML = `
                <button class="control-btn" onclick="showGlobeCollection()" title="Snow Globes">üåê</button>
                <button class="control-btn" onclick="toggleAudio()" title="Toggle Audio">üîä</button>
                <button class="control-btn" onclick="showStats()" title="Stats">üìä</button>
            `;
            document.body.appendChild(controls);

            // Mark session start
            window.sessionStart = Date.now();
        }

        function showGlobeCollection() {
            if (typeof SnowGlobeCollection !== 'undefined') {
                SnowGlobeCollection.showCollection();
            }
        }

        function toggleAudio() {
            if (typeof AudioEngine !== 'undefined') {
                const enabled = AudioEngine.toggle();
                const btn = document.querySelector('.control-btn[title="Toggle Audio"]');
                if (btn) btn.textContent = enabled ? 'üîä' : 'üîá';
            }
        }

        function showStats() {
            const state = typeof MongooseEngine !== 'undefined' ? MongooseEngine.state : {};
            const profile = typeof AdaptiveEngine !== 'undefined' ? AdaptiveEngine.profile : {};
            const globeStats = typeof SnowGlobeCollection !== 'undefined' ? SnowGlobeCollection.getStats() : {};

            const overlay = document.createElement('div');
            overlay.className = 'stats-overlay';
            overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };
            overlay.innerHTML = `
                <div class="stats-panel">
                    <h2>MONGOOSE STATUS</h2>
                    <button class="stats-close" onclick="this.parentElement.parentElement.remove()">√ó</button>

                    <div class="stats-section">
                        <h3>RELATIONSHIP</h3>
                        <div class="stat-row"><span>Loyalty</span><span>‚ù§Ô∏è ${state.loyalty || 0}</span></div>
                        <div class="stat-row"><span>Jin Trust</span><span>üíï ${state.jinTrust || 0}</span></div>
                        <div class="stat-row"><span>Betrayals</span><span>üíî ${state.betrayals || 0}</span></div>
                        <div class="stat-row"><span>Playthrough</span><span>üîÑ ${state.playthrough || 1}</span></div>
                    </div>

                    <div class="stats-section">
                        <h3>COLLECTION</h3>
                        <div class="stat-row"><span>Snow Globes</span><span>üåê ${globeStats.collected || 0}/${globeStats.total || 0}</span></div>
                        <div class="stat-row"><span>Endings Found</span><span>üèÅ ${gameState.endings?.length || 0}</span></div>
                    </div>

                    ${profile.tendencies ? `
                    <div class="stats-section">
                        <h3>PROFILE</h3>
                        ${Object.entries(profile.tendencies || {}).map(([k, v]) =>
                            `<div class="stat-row"><span>${k}</span><span>${Math.round(v)}%</span></div>`
                        ).join('')}
                    </div>
                    ` : ''}
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // Initialize UI after DOM loaded
        document.addEventListener('DOMContentLoaded', initUI);

        // Session persists normally - no forced logout on tab switch

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DEBUG CONSOLE - Type 'mongoose' anywhere
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let debugBuffer = '';
        document.addEventListener('keydown', function(e) {
            debugBuffer += e.key.toLowerCase();
            if (debugBuffer.length > 10) debugBuffer = debugBuffer.slice(-10);

            // Mongoose activates debug
            if (debugBuffer.includes('mongoose')) {
                debugBuffer = '';
                showDebugConsole();
            }

            // Admin code also works
            if (typeof window.ADMIN_CODE !== 'undefined' && debugBuffer.includes(window.ADMIN_CODE)) {
                debugBuffer = '';
                if (typeof AdminPanel !== 'undefined') {
                    AdminPanel.showAdminPanel();
                }
            }
        });

        function showDebugConsole() {
            const state = typeof MongooseEngine !== 'undefined' ? MongooseEngine.state : {};
            const overlay = document.createElement('div');
            overlay.className = 'debug-overlay';
            overlay.id = 'debug-console';
            overlay.innerHTML = `
                <div class="debug-panel">
                    <h2>ü¶é MONGOOSE DEBUG</h2>
                    <button class="debug-close" onclick="document.getElementById('debug-console').remove()">√ó</button>

                    <div class="debug-section">
                        <h3>JUMP TO SECTION</h3>
                        <input type="number" id="debug-section" placeholder="Section #" min="1">
                        <button onclick="debugJumpTo()">GO</button>
                    </div>

                    <div class="debug-section">
                        <h3>SET STATS</h3>
                        <div class="debug-row">
                            <label>Jin Trust:</label>
                            <input type="number" id="debug-jin" value="${state.jinTrust || 0}" min="0" max="20">
                            <button onclick="debugSetJin()">SET</button>
                        </div>
                        <div class="debug-row">
                            <label>Loyalty:</label>
                            <input type="number" id="debug-loyalty" value="${state.loyalty || 0}" min="0" max="20">
                            <button onclick="debugSetLoyalty()">SET</button>
                        </div>
                        <div class="debug-row">
                            <label>Playthrough:</label>
                            <input type="number" id="debug-play" value="${state.playthrough || 1}" min="1" max="10">
                            <button onclick="debugSetPlaythrough()">SET</button>
                        </div>
                    </div>

                    <div class="debug-section">
                        <h3>AWARDS</h3>
                        <button onclick="debugAwardAllGlobes()">Award All Globes</button>
                        <button onclick="debugAwardEllie()">Award E‚Äî Globe</button>
                        <button onclick="debugTriggerDreamcatcher()">Give Dreamcatcher</button>
                        <button onclick="debugTriggerCrystal()">Give Crystal</button>
                    </div>

                    <div class="debug-section">
                        <h3>RESET</h3>
                        <button onclick="debugClearAll()" style="background:#8b0000;color:#fff;">CLEAR ALL DATA</button>
                    </div>

                    <div class="debug-section">
                        <h3>JIN THREAD</h3>
                        <button onclick="debugJumpTo(100)">Start Jin Path (100)</button>
                        <button onclick="debugJumpTo(116)">First Kiss (116)</button>
                        <button onclick="debugJumpTo(200)">Jin HEA Ending (200)</button>
                    </div>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        function debugJumpTo(section) {
            const target = section || parseInt(document.getElementById('debug-section').value);
            if (target) {
                renderSection(target);
                document.getElementById('debug-console')?.remove();
            }
        }

        function debugSetJin() {
            const val = parseInt(document.getElementById('debug-jin').value);
            if (typeof MongooseEngine !== 'undefined') {
                MongooseEngine.state.jinTrust = val;
                MongooseEngine.saveState();
                updateStatsDisplay();
            }
        }

        function debugSetLoyalty() {
            const val = parseInt(document.getElementById('debug-loyalty').value);
            if (typeof MongooseEngine !== 'undefined') {
                MongooseEngine.state.loyalty = val;
                MongooseEngine.saveState();
                updateStatsDisplay();
            }
        }

        function debugSetPlaythrough() {
            const val = parseInt(document.getElementById('debug-play').value);
            if (typeof MongooseEngine !== 'undefined') {
                MongooseEngine.state.playthrough = val;
                MongooseEngine.saveState();
                updateStatsDisplay();
            }
        }

        function debugAwardAllGlobes() {
            if (typeof SnowGlobeCollection !== 'undefined') {
                Object.keys(SnowGlobeCollection.globes).forEach(id => {
                    SnowGlobeCollection.award(id);
                });
                alert('All globes awarded!');
            }
        }

        function debugAwardEllie() {
            if (typeof SnowGlobeCollection !== 'undefined') {
                SnowGlobeCollection.award('ellie');
                alert('E‚Äî globe awarded!');
            }
        }

        function debugTriggerDreamcatcher() {
            if (typeof LifeMoments !== 'undefined') {
                localStorage.removeItem('mongoose_dreamcatcher_given');
                localStorage.removeItem('mongoose_met_jin');
                alert('Dreamcatcher reset - will trigger on next Jin meeting');
            }
        }

        function debugTriggerCrystal() {
            if (typeof LifeMoments !== 'undefined') {
                localStorage.removeItem('mongoose_crystal_found');
                localStorage.removeItem('mongoose_crystal_given');
                alert('Crystal reset - will trigger at trust 8+');
            }
        }

        function debugClearAll() {
            if (confirm('This will erase ALL progress. Are you sure?')) {
                localStorage.clear();
                if (typeof MongooseEngine !== 'undefined') MongooseEngine.resetState();
                location.reload();
            }
        }

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ELLIE GLOBE - Award on first play or special condition
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        function checkEllieGlobe() {
            if (typeof SnowGlobeCollection === 'undefined') return;

            // Award Ellie globe on first successful login
            if (!localStorage.getItem('mongoose_first_login')) {
                localStorage.setItem('mongoose_first_login', 'true');
                // Delay so other UI loads first
                setTimeout(() => {
                    SnowGlobeCollection.award('ellie');
                }, 3000);
            }
        }

        // Check on load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkEllieGlobe, 2000);
        });

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UX ENHANCEMENT HELPERS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Initialize all UX enhancements
        function initUXEnhancements() {
            initParticles();
            initReadingProgress();
            initParallax();
            initHeaderScroll();
        }

        // 22. Floating particles - reduced for performance
        function initParticles() {
            const container = document.getElementById('particles');
            if (!container) return;

            // Only 5 particles for subtle effect
            for (let i = 0; i < 5; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (15 + Math.random() * 15) + 's';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.opacity = '0.15';
                container.appendChild(particle);
            }
        }

        // 9. Reading progress bar
        function initReadingProgress() {
            const content = document.getElementById('content');
            const progressBar = document.getElementById('reading-progress');
            if (!content || !progressBar) return;

            content.addEventListener('scroll', function() {
                const scrollTop = content.scrollTop;
                const scrollHeight = content.scrollHeight - content.clientHeight;
                const progress = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;
                progressBar.style.width = progress + '%';
            });
        }

        // 13. Parallax background
        function initParallax() {
            const content = document.getElementById('content');
            if (!content) return;

            content.addEventListener('scroll', function() {
                const scrollY = content.scrollTop * 0.3;
                document.documentElement.style.setProperty('--scroll-y', -scrollY + 'px');
            });
        }

        // 34. Header scroll effects
        function initHeaderScroll() {
            const content = document.getElementById('content');
            const header = document.querySelector('.header');
            if (!content || !header) return;

            content.addEventListener('scroll', function() {
                if (content.scrollTop > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            });
        }

        // 16. Toast notification system
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = 'toast toast-' + type;

            const icons = { info: '‚ÑπÔ∏è', success: '‚úì', warning: '‚ö†Ô∏è', error: '‚úï', achievement: 'üèÜ' };
            toast.innerHTML = `<span>${icons[type] || ''} ${message}</span>`;

            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, duration);
        }

        // 17. Achievement popup
        function showAchievement(icon, title, description) {
            // Create burst effect
            const burst = document.createElement('div');
            burst.className = 'unlock-burst';
            document.body.appendChild(burst);
            setTimeout(() => burst.remove(), 1000);

            // Create achievement popup
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.innerHTML = `
                <div class="achievement-icon">${icon}</div>
                <div class="achievement-title">${title}</div>
                <div class="achievement-desc">${description}</div>
            `;
            document.body.appendChild(achievement);

            setTimeout(() => {
                achievement.style.animation = 'achievementPop 0.3s ease-in reverse forwards';
                setTimeout(() => achievement.remove(), 300);
            }, 3000);
        }

        // 7. Screen flash on choice
        function flashScreen(color = 'var(--blood)') {
            const flash = document.createElement('div');
            flash.className = 'flash-overlay';
            flash.style.background = color;
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 300);
        }

        // 19. Blood splatter effect
        function bloodSplatter(x, y) {
            const splatter = document.createElement('div');
            splatter.className = 'blood-splatter';
            splatter.style.setProperty('--x', x + '%');
            splatter.style.setProperty('--y', y + '%');
            document.body.appendChild(splatter);
            setTimeout(() => splatter.remove(), 500);
        }

        // 3. Shake screen for danger
        function shakeScreen() {
            document.body.classList.add('shake');
            setTimeout(() => document.body.classList.remove('shake'), 500);
        }

        // 4. Glitch effect for horror
        function glitchScreen(duration = 2000) {
            document.body.classList.add('glitch');
            setTimeout(() => document.body.classList.remove('glitch'), duration);
        }

        // 20. Vignette pulse for tension
        function pulseVignette() {
            const vignette = document.querySelector('.vignette');
            if (vignette) {
                vignette.classList.add('vignette-pulse');
                setTimeout(() => vignette.classList.remove('vignette-pulse'), 2000);
            }
        }

        // 27. Update relationship hearts display
        function renderHearts(value, max = 10) {
            let html = '<div class="hearts">';
            for (let i = 0; i < max; i++) {
                html += `<span class="heart ${i < value ? 'filled' : ''}">‚ô•</span>`;
            }
            html += '</div>';
            return html;
        }

        // 28. Jin trust meter
        function renderJinMeter(trust, max = 20) {
            const percent = Math.min((trust / max) * 100, 100);
            return `
                <div class="jin-meter">
                    <div class="jin-meter-fill" style="width: ${percent}%"></div>
                </div>
            `;
        }

        // 49. Snow effect (for special scenes)
        function startSnow(intensity = 20) {
            let snowContainer = document.querySelector('.snow-overlay');
            if (!snowContainer) {
                snowContainer = document.createElement('div');
                snowContainer.className = 'snow-overlay';
                document.body.appendChild(snowContainer);
            }

            for (let i = 0; i < intensity; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.style.left = Math.random() * 100 + '%';
                flake.style.animationDuration = (3 + Math.random() * 5) + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                flake.style.opacity = 0.3 + Math.random() * 0.7;
                flake.style.width = (3 + Math.random() * 5) + 'px';
                flake.style.height = flake.style.width;
                snowContainer.appendChild(flake);
            }
        }

        function stopSnow() {
            const snowContainer = document.querySelector('.snow-overlay');
            if (snowContainer) snowContainer.remove();
        }

        // 50. End credits
        function showCredits(lines) {
            const credits = document.createElement('div');
            credits.className = 'credits';
            credits.innerHTML = `<div class="credits-text">${lines.join('<br><br>')}</div>`;
            document.body.appendChild(credits);

            setTimeout(() => credits.remove(), 60000);
        }

        // Enhance makeChoice with visual feedback
        const originalMakeChoice = makeChoice;
        makeChoice = function(targetSection, choiceDataEncoded) {
            // Flash screen on choice
            flashScreen();

            // Check for danger sections
            const section = GAME_DATA[targetSection];
            if (section) {
                const content = section.content?.toLowerCase() || '';
                if (content.includes('death') || content.includes('die') || content.includes('killed')) {
                    bloodSplatter(50, 50);
                    shakeScreen();
                }
                if (content.includes('infected') || content.includes('zombie') || content.includes('horror')) {
                    pulseVignette();
                }
                if (section.isEnding) {
                    showToast('Ending reached!', 'achievement');
                }
            }

            // Call original
            originalMakeChoice(targetSection, choiceDataEncoded);
        };

        // Run UX init after DOM loaded
        document.addEventListener('DOMContentLoaded', initUXEnhancements);
    </script>

    <style>
        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           MONGOOSE UI - RESPONSIVE DESIGN
           ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

        /* DESKTOP: Stats in top-right corner */
        .mongoose-stats {
            position: fixed;
            top: 12px;
            right: 80px;
            display: flex;
            gap: 20px;
            font-family: 'Space Mono', monospace;
            font-size: 0.75em;
            color: rgba(255,255,255,0.7);
            z-index: 150;
            align-items: center;
        }

        .mongoose-stats .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .mongoose-stats .stat-label {
            color: rgba(139,0,0,0.7);
            font-size: 0.85em;
        }

        .mongoose-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 150;
        }

        .control-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(139,0,0,0.5);
            color: #fff;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            border-color: #8b0000;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(139,0,0,0.3);
        }

        /* MOBILE: Responsive adjustments */
        @media (max-width: 768px) {
            /* Header adjustments */
            .header {
                padding: 0.75rem 1rem;
                flex-wrap: wrap;
            }

            .title-small {
                font-size: 0.75rem;
                letter-spacing: 0.2em;
            }

            /* Stats move below header on mobile */
            .mongoose-stats {
                position: fixed;
                top: auto;
                bottom: 80px;
                left: 10px;
                right: auto;
                flex-direction: column;
                gap: 8px;
                font-size: 0.7em;
                background: rgba(0,0,0,0.8);
                padding: 10px;
                border-radius: 8px;
                border: 1px solid rgba(139,0,0,0.3);
            }

            .mongoose-stats .stat-item {
                justify-content: flex-start;
            }

            /* Controls at bottom center on mobile */
            .mongoose-controls {
                bottom: 15px;
                right: 50%;
                transform: translateX(50%);
            }

            .control-btn {
                width: 48px;
                height: 48px;
            }

            /* Content padding for mobile */
            .content {
                padding: 1.5rem 1rem 100px;
            }

            /* Choices full width on mobile */
            .choice {
                padding: 1rem;
                font-size: 0.95em;
            }

            /* Smaller thread indicators on mobile */
            .thread-indicators {
                gap: 3px;
            }

            .thread {
                width: 6px;
                height: 6px;
            }
        }

        /* TABLET: Medium screens */
        @media (min-width: 769px) and (max-width: 1024px) {
            .mongoose-stats {
                right: 70px;
                gap: 15px;
                font-size: 0.7em;
            }

            .content {
                padding: 2rem 2rem 4rem;
                max-width: 800px;
                margin: 0 auto;
            }
        }

        /* DESKTOP LARGE: Wide screens */
        @media (min-width: 1025px) {
            .content {
                padding: 2rem 3rem 4rem;
                max-width: 900px;
                margin: 0 auto;
            }

            .choice {
                max-width: 700px;
            }
        }

        .ngplus-overlay, .stats-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .ngplus-content, .stats-panel {
            background: linear-gradient(180deg, rgba(20,20,30,0.98), rgba(10,10,20,0.98));
            border: 2px solid rgba(139,0,0,0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
        }

        .ngplus-cycle {
            font-family: 'Cinzel', serif;
            font-size: 2em;
            color: #8b0000;
            margin-bottom: 20px;
        }

        .ngplus-message {
            color: #e8e0d5;
            line-height: 1.6;
            margin-bottom: 20px;
            font-style: italic;
        }

        .ngplus-carryover {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            color: rgba(255,255,255,0.7);
            font-size: 0.9em;
        }

        .ngplus-content button, .stats-panel button {
            background: transparent;
            border: 1px solid #8b0000;
            color: #8b0000;
            padding: 10px 30px;
            font-family: 'Space Mono', monospace;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ngplus-content button:hover, .stats-panel button:hover {
            background: #8b0000;
            color: #fff;
        }

        .stats-panel {
            text-align: left;
            min-width: 300px;
            position: relative;
        }

        .stats-panel h2 {
            font-family: 'Cinzel', serif;
            color: #8b0000;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #666;
            font-size: 1.5em;
            cursor: pointer;
            padding: 0;
        }

        .stats-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .stats-section h3 {
            color: rgba(255,255,255,0.5);
            font-size: 0.8em;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            color: #e8e0d5;
        }

        /* Jin moment styling */
        .jin-moment {
            border-left: 3px solid #8b0000;
            padding-left: 15px;
            margin: 20px 0;
            background: linear-gradient(90deg, rgba(139,0,0,0.1), transparent);
        }
    </style>
</body>
</html>
